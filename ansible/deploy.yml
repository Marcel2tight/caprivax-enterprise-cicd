---
- name: Enterprise SmartOps Deployment
  hosts: all
  become: yes
  serial: 1  

  vars:
    nexus_ip: "10.128.0.7"
    # PATH FIX: Matches com.caprivax from Nexus metadata
    group_id_path: "com/caprivax"
    artifact_id: "smartops-backend"
    extension: "jar"
    app_dest: "/opt/smartops-api.{{ extension }}"

  tasks:
    - name: ðŸ“¦ Download Artifact from Nexus
      get_url:
        url: "http://{{ nexus_ip }}:8081/repository/java-webapp-releases/{{ group_id_path }}/{{ artifact_id }}/{{ app_version }}/{{ artifact_id }}-{{ app_version }}.{{ extension }}"
        dest: "{{ app_dest }}"
        url_username: admin
        url_password: "{{ nexus_pwd }}"
        force_basic_auth: yes
        timeout: 30

    - name: ðŸš€ Restart SmartOps Service
      systemd:
        name: smartops
        state: restarted
        daemon_reload: yes
        enabled: yes
